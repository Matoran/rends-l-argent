<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rends l'argent</title>
    <style>
        canvas {
            height: 710px;
            width: 710px;
            float: left;
        }

        form{
            float: left;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="710" height="710"></canvas>
<form method="post" id="form">
    <p>
    <div id="blocType" style="display: none">
        <label for="typeCarte">Quel type de carte?</label><br />
        <select name="typeCarte" id="typeCarte">
            <option value="Propriete">Propriété</option>
            <option value="Gare">Gare</option>
            <option value="Chance">Chance</option>
            <option value="Caisse de communaute">Caisse de communauté</option>
            <option value="Services publiques">Services publiques</option>
            <option value="Impots et taxe">Impôts et taxe</option>
            <option value="Prison">Prison</option>
            <option value="Aller en prison">Aller en prison</option>
            <option value="Parking gratuit">Parking gratuit</option>
        </select>
    </div>
    <div id="blocService" style="display: none">
        <label for="service">Quel type de Service publique?</label><br />
        <select name="service" id="service">
            <option value="Electricite">Electricité</option>
            <option value="Eau">Eau</option>
        </select>
    </div>
    <div id="blocTaxe" style="display: none">
        <label for="taxe">Quel type d'impôts et taxe?</label><br />
        <select name="taxe" id="taxe">
            <option value="luxe">Objet de luxe</option>
            <option value="impots">Impôts</option>
        </select>
    </div>
    <div id="blocName" style="display: none">
        <label for="name">Nom de la carte</label><br />
        <input id="name" name="name" value="Nom">
    </div>
    <div id="blocColor" style="display: none">
        <label for="color">Couleur de la famille de carte</label><br />
        <select name="color" id="color">
            <option value="red">Rouge</option>
            <option value="blue">Bleu</option>
            <option value="orange">Orange</option>
            <option value="black">Noir</option>
            <option value="green">Vert</option>
            <option value="purple">Violet</option>
            <option value="pink">Rose</option>
            <option value="yellow">Jaune</option>
        </select>
    </div>
    <div id="blocPrice" style="display: none">
        <label for="name">Prix</label><br />
        <input type="number" id="price" name="price" value="1"/>
    </div>
    <input type="button" value="valider" id="button" onclick="send()" style="display: none">
    </p>
    <input type="hidden" id="id" value="">
</form>
</body>
<script src="easeljs-0.8.2.min.js"></script>
<script>
    let stage = new createjs.Stage("canvas");

    let img = new Image();
    img.src = "img/dice-1-th.png";
    let img2 = new Image();
    img2.src = "img/dice-1-th.png";

    function drawImage(posx,posy, event) {
        let image = event.target;
        let bitmap = new createjs.Bitmap(image);
        bitmap.x = posx;
        bitmap.y = posy;
        bitmap.addEventListener("click", onClick);
        stage.addChild(bitmap);
        stage.update();
    }

    img.onload = function (event) {drawImage(0,0, event);};
    img2.onload = function (event) {drawImage(100,0, event);};

    function onClick() {
        let rand = Math.floor((Math.random() * 6) + 1);
        let rand2 = Math.floor((Math.random() * 6) + 1);
        img.src = "img/dice-" + rand + "-th.png";
        img2.src = "img/dice-" + rand2 + "-th.png";
    }

    function squareOnClick(identifiant) {
        let type = document.getElementById("blocType");
        let name = document.getElementById("blocName");
        let price = document.getElementById("blocPrice");
        let color = document.getElementById("blocColor");
        let button = document.getElementById("button");
        let id = document.getElementById("id");
        id.value = identifiant;
        type.style.display = "block";
        name.style.display = "block";
        price.style.display = "block";
        color.style.display = "block";
        button.style.display = "block";
        let card = document.getElementById('typeCarte');
        card.selectedIndex = "Propriete";
    }



    function strcutSquare(posx,posy, id){
        return{
            posx : posx,
            posy : posy,
            width : 90,
            heigth : 58,
            id : id
        };
    }

    function square(squareParam) {
        let square = new createjs.Shape();
        let commandSquare = square.graphics.beginFill("black").command;
        square.graphics.drawRect(0, 0, squareParam.width, squareParam.heigth);
        square.x = squareParam.posx;
        square.y = squareParam.posy;
        commandSquare.style = "tomato";
        square.on("click", function(){
            squareOnClick(squareParam.id);
        });
        let label = new createjs.Text("", "12px Arial", "#000000");
        return{
            square : square,
            commandeSquare: commandSquare,
            label : label
        };
    }

    let tabSquare = [square(strcutSquare(100,100,0)), square(strcutSquare(100,200,1))];

    tabSquare.forEach(function (s) {
        stage.addChild(s.square);
    });
    stage.update();

    var card = document.getElementById('typeCarte');
    // change the form
    card.addEventListener('change', function() {
        let name = document.getElementById("blocName");
        let price = document.getElementById("blocPrice");
        let color = document.getElementById("blocColor");
        let service = document.getElementById("blocService");
        let taxe = document.getElementById("blocTaxe");

        let value = card.options[card.selectedIndex].value;

        name.style.display = "none";
        price.style.display = "none";
        color.style.display = "none";
        service.style.display = "none";
        taxe.style.display = "none";

        if(value == "Propriete"){
            name.style.display = "block";
            price.style.display = "block";
            color.style.display = "block";
        }else if(value == "Gare"){
            name.style.display = "block";
        }else if(value == "Services publiques"){
            service.style.display = "block";
        }else if(value == "Impots et taxe") {
            taxe.style.display = "block";
        }
    });

    function cleanForm(){
        let type = document.getElementById("blocType");
        let name = document.getElementById("blocName");
        let price = document.getElementById("blocPrice");
        let color = document.getElementById("blocColor");
        let button = document.getElementById("button");
        let id = document.getElementById("id");
        let service = document.getElementById("blocService");
        let taxe = document.getElementById("blocTaxe");
        id.value = 0;
        type.style.display = "none";
        name.style.display = "none";
        price.style.display = "none";
        color.style.display = "none";
        button.style.display = "none";
        service.style.display = "none";
        taxe.style.display = "none";
    }

    function send() {
        let id = document.getElementById("id").value;
        let value = card.options[card.selectedIndex].value;
        let text = value;
        if(value == "Propriete"){
            let name = document.getElementById("name").value;
            let color = document.getElementById("color").value;
            let price = document.getElementById("price").value;
            tabSquare[id].commandeSquare.style = color;
            text += "\n" + name + "\n" + color + "\n" + price;
        }else if(value == "Gare"){
            let name = document.getElementById("name").value;
            text +=  "\n" + name;
        }else if(value == "Services publiques"){
            let service = document.getElementById("service");
            service = service.options[service.selectedIndex].value;
            text += "\n" + service;
        }else if(value == "Impots et taxe") {
            let taxe = document.getElementById("taxe");
            taxe = taxe.options[taxe.selectedIndex].value;
            text +=  "\n" + taxe;
        }
        //console.log(document.getElementById("id").value);
        tabSquare[id].label.text = text;
        tabSquare[id].label.x = tabSquare[id].square.x;
        tabSquare[id].label.y = tabSquare[id].square.y;
        tabSquare[id].label.alpha = 0.5;


        stage.addChild( tabSquare[id].label);
        stage.update();
        cleanForm();
    }
</script>
</html>